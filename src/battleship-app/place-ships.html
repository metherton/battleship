<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-badge/paper-badge.html" >
<link rel="import" href="grid-square.html">


<dom-module id="place-ships">

    <template>

        <style>
            .bg-white .box  {
                background-color: white;
                color: black;
            }
            .container {
                display: grid;
                margin-left: 40px;
                margin-top: 10px;
                grid-template-columns: 500px 500px;
            }
            .wrapper {
                display: grid;
                grid-gap: 1px;
                grid-template-columns: 40px 40px 40px 40px 40px 40px 40px 40px 40px 40px 40px;
                background-color: white;
                color: aliceblue;
            }
            .select-boats {
                margin-left: 40px;
                margin-top: 40px;
            }
        </style>

        <div class="container">
            <div class="wrapper">
                <template is="dom-repeat" items="{{columnHeaders}}">
                    <div style="background-color: white; color: black" class="box bg-white">{{item}}</div>
                </template>
                <template is="dom-repeat" items="{{rowHeaders}}">
                    <div style="background-color: white; color: black" class="box bg-white">{{item}}</div>
                    <template as="columnNumber" is="dom-repeat" items="[1,2,3,4,5,6,7,8,9,10]">
                        <grid-square row="[[item]]" column="[[columnNumber]]"></grid-square>
                    </template>
                </template>
            </div>
            <div class="select-boats">
                <p>Select a boat and click a square on the grid to place it</p>
                <template is="dom-repeat" items="{{boats}}">
                    <p><paper-checkbox id="{{index}}" on-tap="handleTap">{{item.name}}</paper-checkbox></p>
                </template>
            </div>
        </div>
    </template>

    <script>

        /**
         * @customElement
         * @polymer
         */
        class PlaceShips extends Polymer.Element {
            static get is() { return 'place-ships'; }

            static get properties() {
                return {
                    columnHeaders: {
                        type: Array,
                        value: ['','A','B','C','D','E','F','G','H','I','J']
                    },
                    rowHeaders: {
                        type: Array,
                        value: ['1','2','3','4','5','6','7','8','9','10']
                    },
                    boats: {
                        type: Array,
                        value: [{name: 'Frigate'}, {name: 'Frigate'}, {name: 'Destroyer'}, {name: 'Destroyer'}, {name: 'Carrier'}]
                    }
                };
            }

            connectedCallback() {
                super.connectedCallback();
            }

            ready() {
                super.ready();
                this.addEventListener('cellClicked', e => this._cellClicked(e));
            }

            handleTap(e) {



                let event = new CustomEvent('boatSelected', {bubbles: true, composed: true});
                event.boatIndex = e.target.id;
                this.dispatchEvent(event);
            }

            _cellClicked(event) {

                let boatCheckboxes = this.shadowRoot.querySelectorAll('paper-checkbox');
                let boatSelected = false;
                boatCheckboxes.forEach(function(box) {
                   if (box.checked && !box.disabled) {
                       boatSelected = true;
                   }
                });
                if (boatSelected) {
                    window.alert('valid');
                } else {
                    window.alert('invalid');
                }
//                window.alert('row:' + event.row + ', column:' + event.column);
            }

        }

        window.customElements.define(PlaceShips.is, PlaceShips);
    </script>
</dom-module>
